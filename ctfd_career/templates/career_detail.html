{% extends "page.html" %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('career.static', filename='css/career.css') }}" />
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row mb-4 align-items-center">
    <div class="col-md-8">
      <h1 class="display-6 mb-2">{{ career.name }}</h1>
      {% if career.description %}
      <div class="text-muted">{{ career.description | safe }}</div>
      {% endif %}
    </div>
    {% if career.icon %}
    <div class="col-md-4 text-md-end mt-3 mt-md-0">
      <img src="{{ career.icon }}" alt="{{ career.name }} icon" class="career-icon" />
    </div>
    {% endif %}
  </div>

  {% set total_steps = career.steps | length %}
  {% set completed_steps = career.steps | selectattr('completed') | list | length %}
  {% set percent = (completed_steps / total_steps * 100) | round(0, 'floor') if total_steps else 0 %}

  <div class="mb-4">
    {% include "components/progress_bar.html" with context %}
    <div class="small text-muted mt-2">
      {{ translations.get('Progress Summary', 'Progress Summary') }}:
      {{ completed_steps }}/{{ total_steps }}
    </div>
  </div>

  {% if not career.steps %}
  <div class="alert alert-info">{{ translations.get('No steps available', 'No steps available') }}</div>
  {% else %}
  <div class="row g-4">
    {% for step in career.steps %}
    <div class="col-md-6">
      <div class="card h-100 shadow-sm">
        {% if step.image_url %}
        <img src="{{ step.image_url }}" alt="{{ step.name }} illustration" class="card-img-top object-fit-cover" style="max-height: 180px;" />
        {% endif %}
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title mb-0">{{ step.name }}</h5>
            <span class="badge {{ 'bg-success' if step.completed else 'bg-secondary' }}">
              {{ translations.get('Completed', 'Completed') if step.completed else translations.get('In Progress', 'In Progress') }}
            </span>
          </div>
          {% if step.description %}
          <p class="card-text">{{ step.description | safe }}</p>
          {% endif %}
          <ul class="list-unstyled text-muted small mt-auto">
            {% if step.category %}
            <li><strong>{{ translations.get('Category', 'Category') }}:</strong> {{ step.category }}</li>
            {% endif %}
            {% if step.challenge_id %}
            <li><strong>{{ translations.get('Challenge ID', 'Challenge ID') }}:</strong> {{ step.challenge_id }}</li>
            {% endif %}
            {% if step.required_solves is not none %}
            <li><strong>{{ translations.get('Required Solves', 'Required Solves') }}:</strong> {{ step.required_solves }}</li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
