{% extends "base.html" %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('career.static', filename='css/career.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-lg-4">
      <h2 class="text-primary mb-3">{{ career.name }}</h2>
      {% if career.description %}
      <p>{{ career.description | safe }}</p>
      {% endif %}

      {% set total_steps = career.steps | length %}
      {% set completed_steps = career.steps | selectattr('completed') | list | length %}
      {% set percent = (completed_steps / total_steps * 100) if total_steps else 0 %}
      {% include "components/progress_bar.html" %}

      {% for step in career.steps %}
      <div class="card mb-3 shadow-sm" data-step-id="{{ step.id }}">
        <div class="card-body">
          <h5 class="card-title">{{ step.name }}</h5>
          {% if step.description %}
          <p class="card-text">{{ step.description | safe }}</p>
          {% endif %}
          {% if step.image_url %}
          <img src="{{ step.image_url }}" class="img-fluid rounded mb-2" alt="{{ step.name }} image">
          {% endif %}
          <ul class="list-unstyled text-muted small mb-3">
            {% if step.category %}
            <li><strong>{{ translations.get('Category', 'Category') }}:</strong> {{ step.category }}</li>
            {% endif %}
            {% if step.challenge_id %}
            <li>
              <strong>
                {{
                  translations.get(
                    'Desafio vinculado',
                    translations.get('Challenge', 'Challenge')
                  )
                }}:
              </strong>
              {{ step.challenge_id }}
            </li>
            {% endif %}
            {% if step.required_solves is not none %}
            <li><strong>{{ translations.get('Required Solves', 'Required Solves') }}:</strong> {{ step.required_solves }}</li>
            {% endif %}
          </ul>
          {% if step.challenge_id %}
          <button class="btn btn-outline-info btn-sm" onclick="carregarDesafio({{ step.challenge_id }})">
            {{ translations.get('Resolver desafio', 'Resolver desafio') }}
          </button>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="col-lg-8">
      <div id="area-desafio" class="mt-3"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  window.CTFDCareerTranslations = {{ translations | tojson | safe }};
</script>
<script src="{{ url_for('career.static', filename='js/career_detail.js') }}" defer></script>
{% endblock %}
